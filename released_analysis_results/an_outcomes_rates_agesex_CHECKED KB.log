----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_outcomes_rates_agesex.log
  log type:  text
 opened on:  16 Jul 2020, 19:21:35

. 
. run global 

. 
. use "cr_create_analysis_dataset_STSET_onsdeath_fail1", clear
(Analysis dataset HIV project)

. 
. if "`1'"=="rates_agesex"{
. strate hiv, per(365000) output(./output/an_outcomes_RATES, replace)

         failure _d:  onsdeath == 1
   analysis time _t:  (stime_onsdeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Estimated failure rates
Number of records  =       17282435

  +--------------------------------------------------+
  | hiv       D         Y     Rate    Lower    Upper |
  |--------------------------------------------------|
  |   0   14857   6.7e+03   2.2186   2.1832   2.2546 |
  |   1      25   10.6754   2.3418   1.5824   3.4657 |
  +--------------------------------------------------+
   Notes: Rate = D/Y = failures/person-time (per 365000).
          Lower and Upper are bounds of 95% confidence intervals.

. 
. 
. ******************************
. *  Age-sex Cox model  *
. ******************************
. capture stcox age1 age2 age3 i.male i.hiv, strata(stp) 
. if _rc==0 {
.                 noi di _n  "AGE-SEX ADJUSTED (FULL STUDY POP)" _n 

AGE-SEX ADJUSTED (FULL STUDY POP)

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,435                  Number of obs    =  17,282,435
No. of failures =       14,882
Time at risk    =   2448136011
                                                LR chi2(5)       =    47229.10
Log likelihood  =   -176881.06                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        age1 |   1.171971   .0224916     8.27   0.000     1.128707    1.216893
        age2 |   .9018268   .0374519    -2.49   0.013     .8313304    .9783013
        age3 |   1.297252    .124351     2.71   0.007     1.075055    1.565374
      1.male |   1.676499   .0279073    31.04   0.000     1.622684    1.732098
       1.hiv |   2.898844   .5817359     5.30   0.000     1.956171    4.295787
------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_agesex, replace
file ./output/models/an_outcomes_agesex.ster saved
.                 }
.         else {
.         di "WARNING - AGESEX MODEL DID NOT SUCCESSFULLY FIT"
.         }
. 
. }

. 
. 
. **************************************
. *  Demographics +/- ethnicity model  *
. **************************************
. 
. if "`1'"=="demog_cceth"{
. capture stcox age1 age2 age3 i.male i.imd i.ethnicity i.hiv, strata(stp) 
. if _rc==0 {
.                 noi di _n "DEMOGRAPHICS ADJUSTED INCLUDING ETHNICITY (COMPLETE CASES)" _n 
.                 estimates
.                 estimates save ./output/models/an_outcomes_adjdemographics_inceth, replace
.                 }
.         else di "WARNING - hiv adj demog inc CC eth MODEL DID NOT SUCCESSFULLY FIT"
. }

. 
. if "`1'"=="demog_noeth"{
. capture stcox age1 age2 age3 i.male i.imd i.hiv, strata(stp) 
. if _rc==0 {
.                 noi di _n  "DEMOGRAPHICS ADJUSTED EXCLUDING ETHNICITY (FULL STUDY POP)" _n 
.                 estimates
.                 estimates save ./output/models/an_outcomes_adjdemographics_noeth, replace
.                 }
.         else di "WARNING - hiv adj demog no eth MODEL DID NOT SUCCESSFULLY FIT"
. }

. 
. ******************************
. *  Multivariable Cox model  *
. ******************************
. 
. if "`1'"=="mv_cceth"{
. capture stcox   i.hiv i.ethnicity $adjustmentlist , strata(stp)
. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES)" _n 
.                 estimates
.                 estimates save ./output/models/an_outcomes_adjfull_inceth, replace
.                 }
.         else di "WARNING - hiv adj demog inc CC eth MODEL DID NOT SUCCESSFULLY FIT"
. }

. 
. if "`1'"=="mv_noeth"{
. capture stcox   i.hiv $adjustmentlist , strata(stp)
. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL NO ETHNICITY " _n 
.                 estimates
.                 estimates save ./output/models/an_outcomes_adjfull_noeth, replace
.                 }
.         else di "WARNING - hiv full adj exc eth MODEL DID NOT SUCCESSFULLY FIT"
. }

. 
. if "`1'"=="mv_addhepc"{
. capture stcox   i.hiv  i.ethnicity i.hepc $adjustmentlist , strata(stp)
. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES) PLUS HEP C" _n 
.                 estimates
.                 estimates save ./output/models/an_outcomes_adjfull_plushepc_inceth, replace
.                 }
.         else di "WARNING - hiv full adj plus hepc inc eth MODEL DID NOT SUCCESSFULLY FIT"
. }

.         
. log close
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_outcomes_rates_agesex.log
  log type:  text
 closed on:  16 Jul 2020, 20:00:45
----------------------------------------------------------------------------------------------------------------------------------
