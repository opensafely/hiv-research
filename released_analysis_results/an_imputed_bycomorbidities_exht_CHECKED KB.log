----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_bycomorbidities_exht.log
  log type:  text
 opened on:  29 Aug 2020, 19:21:13

. 
. ********************************   NOTES  **************************************
. 
. *  Assumes region is string, taking  values: 
. *    East, East Midlands, London, North East, North West, South East, 
. *    South West, West Midlands, and Yorkshire and The Humber
. *
. *  Assumes ethnicity is numeric, taking values: 
. *       1, 2, 3, 4, 5, (missing: . or .u)
. *       in the order White, Black, Asian, Mixed, Other
. *       with value labels exactly as above. 
. *       (NB: this is now intially recoded from ordering: 
. *      White, Mixed, Asian, Black, Other)       
. *
. *
. *  Assumes a complete case sample other than ethnicity
. *
. ********************************************************************************
. 
. run global

. 
. * Add imputations to the full dataset
. use "an_impute_imputeddata", clear
(Analysis dataset HIV project)

. 
. **************************
. *  Analyse imputed data  *
. **************************
. 
. // Declare imputed data as survival
. 
. mi stset stime_onsdeath, fail(onsdeath==1) enter(enter_date)    ///
>         origin(enter_date) id(patient_id)

                id:  patient_id
     failure event:  onsdeath == 1
obs. time interval:  (stime_onsdeath[_n-1], stime_onsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17282435  total observations
          0  exclusions
------------------------------------------------------------------------------
   17282435  observations remaining, representing
   17282435  subjects
     14,882  failures in single-failure-per-subject data
 2.4481e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       142

. 
. 
. if "`1'"=="demog"{
. mi estimate, eform: stcox i.hiv age1 age2 age3 i.male i.imd i.ethnicity, strata(stp)
. estimates save "./output/models/an_imputed_demog", replace                                              
. }

. 
. if "`1'"=="full"{
. mi estimate: stcox i.hiv i.ethnicity $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_full", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="fullplushepc"{
. mi estimate: stcox i.hiv i.ethnicity i.hepc $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_fullplushepc", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="byage"{
. gen ageover60 = agegroup>=4
. mi estimate (_b[1.hiv]+_b[1.hiv#1.ageover60]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd 1.hiv#1.ageover60, strata(stp
> )
. estimates save "./output/models/an_imputed_byage", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bysex"{
. mi estimate (_b[1.hiv]+_b[1.hiv#1.male]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.male, strata(stp)
. estimates save "./output/models/an_imputed_bysex", replace      
. mi estimate, eform                                      
. }

. 
. if "`1'"=="byethnicity"{
. mi passive: gen nonblack = (ethnicity != 4) if ethnicity<.
. mi estimate (_b[1.hiv]+_b[1.hiv#1.nonblack]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.nonblack, strata(stp)
. estimates save "./output/models/an_imputed_byethnicity", replace        
. mi estimate, eform                                      
. }

. 
. 
. if "`1'"=="bycomorbidities"{
. gen anycomorbidity =                                            ///
>         hypertension                                    ///
>         |chronic_respiratory_disease    ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd ///
>         i.hypertension                                  ///
>         i.chronic_respiratory_disease   ///
>         i.asthmacat                                             ///
>         i.chronic_cardiac_disease               ///
>         i.diabcat                                               ///
>         i.cancer_exhaem_cat                     ///
>         i.cancer_haem_cat                               ///
>         i.chronic_liver_disease                 ///
>         i.stroke_dementia                               ///
>         i.other_neuro                                   ///
>         i.reduced_kidney_function_cat   ///
>         i.organ_transplant                              ///
>         i.spleen                                                ///
>         i.ra_sle_psoriasis                      ///
>         i.other_imm_except_hiv                  ///
>         1.hiv#1.anycomorbidity, strata(stp)
. estimates save "./output/models/an_imputed_bycomorbidities", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bycomorbidities_exht"{
. gen anycomorbidity_exht =                       ///                     
>         chronic_respiratory_disease     ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity_exht]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd ///
>         i.chronic_respiratory_disease   ///
>         i.asthmacat                                             ///
>         i.chronic_cardiac_disease               ///
>         i.diabcat                                               ///
>         i.cancer_exhaem_cat                     ///
>         i.cancer_haem_cat                               ///
>         i.chronic_liver_disease                 ///
>         i.stroke_dementia                               ///
>         i.other_neuro                                   ///
>         i.reduced_kidney_function_cat   ///
>         i.organ_transplant                              ///
>         i.spleen                                                ///
>         i.ra_sle_psoriasis                      ///
>         i.other_imm_except_hiv                  ///
>         1.hiv#1.anycomorbidity_exht, strata(stp)

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0294
                                                Largest FMI       =     0.4111
DF adjustment:   Large sample                   DF:     min       =      58.76
                                                        avg       =   1.45e+10
                                                        max       =   2.03e+11
Model F test:       Equal FMI                   F(  36,388537.5)  =    1046.73
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |    .438556   .5009506     0.88   0.381    -.5432892    1.420401
                              |
                    ethnicity |
                       Mixed  |   .3537267   .1306492     2.71   0.009     .0922754    .6151779
      Asian or Asian British  |     .21189   .0402089     5.27   0.000     .1328708    .2909092
                       Black  |   .3454479   .0567679     6.09   0.000       .23414    .4567558
                       Other  |      .1993   .0865885     2.30   0.022     .0290605    .3695394
                              |
                         age1 |   .1743438   .0198252     8.79   0.000     .1354871    .2132004
                         age2 |  -.1606591   .0428002    -3.75   0.000    -.2445459   -.0767723
                         age3 |   .3838014    .098694     3.89   0.000     .1903648    .5772381
                       1.male |   .4090427   .0169093    24.19   0.000      .375901    .4421844
                              |
                          imd |
                           2  |   .1308181   .0272571     4.80   0.000     .0773952    .1842409
                           3  |   .2082678   .0273496     7.62   0.000     .1546635    .2618721
                           4  |   .4132594   .0269318    15.34   0.000      .360474    .4660449
             5 most deprived  |   .5446493   .0276882    19.67   0.000     .4903815    .5989172
                              |
1.chronic_respiratory_disease |   .5125534   .0211935    24.18   0.000     .4710148    .5540919
                              |
                    asthmacat |
                 Yes, no OCS  |   .0082104   .0264012     0.31   0.756    -.0435351    .0599559
                Yes with OCS  |   .1304758   .0488549     2.67   0.008     .0347221    .2262296
                              |
    1.chronic_cardiac_disease |   .1970369   .0183807    10.72   0.000     .1610114    .2330623
                              |
                      diabcat |
         Controlled diabetes  |   .2429935   .0213951    11.36   0.000       .20106    .2849271
       Uncontrolled diabetes  |   .6646351   .0275601    24.12   0.000     .6106182    .7186519
  Diabetes, no hba1c measure  |   .6047057   .0430971    14.03   0.000     .5202369    .6891745
                              |
            cancer_exhaem_cat |
                   Last year  |   .5744488   .0582901     9.85   0.000     .4602022    .6886954
               2-5 years ago  |   .1881756   .0411867     4.57   0.000     .1074511    .2689001
                    5+ years  |   .0065448   .0268778     0.24   0.808    -.0461347    .0592243
                              |
              cancer_haem_cat |
                   Last year  |   1.069779   .1277858     8.37   0.000     .8193232    1.320234
               2-5 years ago  |   .8279625    .082215    10.07   0.000     .6668241    .9891009
                    5+ years  |   .4774884   .0660868     7.23   0.000     .3479608    .6070161
                              |
      1.chronic_liver_disease |     .66014   .0633789    10.42   0.000     .5359196    .7843604
            1.stroke_dementia |   .7618039   .0205736    37.03   0.000     .7214803    .8021274
                1.other_neuro |   .9939704   .0340629    29.18   0.000     .9272084    1.060732
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   .2631383   .0194275    13.54   0.000     .2250611    .3012155
           Stage 4/5 egfr<30  |   .9015955   .0332268    27.13   0.000     .8364722    .9667187
                              |
           1.organ_transplant |   1.117369   .1133444     9.86   0.000     .8952182     1.33952
                     1.spleen |   .2223442   .1405583     1.58   0.114     -.053145    .4978335
           1.ra_sle_psoriasis |   .1910816   .0289782     6.59   0.000     .1342853    .2478778
       1.other_imm_except_hiv |     1.2659   .1867695     6.78   0.000     .8998381    1.631961
                              |
      hiv#anycomorbidity_exht |
                         1 1  |    .463604   .5459563     0.85   0.396    -.6064506    1.533659
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0004
                                                Largest FMI       =     0.0004
DF adjustment:   Large sample                   DF:     min       =   5.16e+07
                                                        avg       =   5.16e+07
Within VCE type:          OIM                           max       =   5.16e+07

        _mi_1: _b[1.hiv]+_b[1.hiv#1.anycomorbidity_exht]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |     .90216   .2193375     4.11   0.000     .4722665    1.332054
------------------------------------------------------------------------------
. estimates save "./output/models/an_imputed_bycomorbidities_exht", replace
file ./output/models/an_imputed_bycomorbidities_exht.ster saved
. mi estimate, eform                                              

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0294
                                                Largest FMI       =     0.4111
DF adjustment:   Large sample                   DF:     min       =      58.76
                                                        avg       =   1.45e+10
                                                        max       =   2.03e+11
Model F test:       Equal FMI                   F(  36,388537.5)  =    1046.73
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |     exp(b)   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   1.550467   .7767073     0.88   0.381     .5808346    4.138781
                              |
                    ethnicity |
                       Mixed  |   1.424366   .1860923     2.71   0.009     1.096667    1.849986
      Asian or Asian British  |   1.236012   .0496986     5.27   0.000     1.142102    1.337643
                       Black  |   1.412623   .0801916     6.09   0.000     1.263821    1.578943
                       Other  |   1.220548   .1056854     2.30   0.022     1.029487    1.447068
                              |
                         age1 |   1.190465   .0236012     8.79   0.000     1.145094    1.237633
                         age2 |   .8515823   .0364479    -3.75   0.000       .78306    .9261007
                         age3 |   1.467854   .1448683     3.89   0.000     1.209691    1.781112
                       1.male |   1.505376   .0254549    24.19   0.000     1.456303    1.556103
                              |
                          imd |
                           2  |    1.13976   .0310665     4.80   0.000     1.080469    1.202305
                           3  |   1.231543   .0336822     7.62   0.000     1.167265     1.29936
                           4  |   1.511737   .0407139    15.34   0.000     1.434009    1.593679
             5 most deprived  |   1.724004   .0477345    19.67   0.000     1.632939    1.820147
                              |
1.chronic_respiratory_disease |   1.669549   .0353836    24.18   0.000     1.601619     1.74036
                              |
                    asthmacat |
                 Yes, no OCS  |   1.008244   .0266189     0.31   0.756      .957399     1.06179
                Yes with OCS  |    1.13937   .0556638     2.67   0.008     1.035332    1.253864
                              |
    1.chronic_cardiac_disease |   1.217789   .0223838    10.72   0.000     1.174698     1.26246
                              |
                      diabcat |
         Controlled diabetes  |    1.27506     .02728    11.36   0.000     1.222698    1.329665
       Uncontrolled diabetes  |   1.943781   .0535708    24.12   0.000      1.84157    2.051665
  Diabetes, no hba1c measure  |   1.830713   .0788984    14.03   0.000     1.682426     1.99207
                              |
            cancer_exhaem_cat |
                   Last year  |   1.776151   .1035321     9.85   0.000     1.584394    1.991116
               2-5 years ago  |   1.207045   .0497143     4.57   0.000     1.113436    1.308524
                    5+ years  |   1.006566   .0270543     0.24   0.808     .9549133    1.061013
                              |
              cancer_haem_cat |
                   Last year  |   2.914734   .3724615     8.37   0.000     2.268964    3.744298
               2-5 years ago  |   2.288651   .1881614    10.07   0.000     1.948041    2.688816
                    5+ years  |   1.612021   .1065332     7.23   0.000     1.416177    1.834948
                              |
      1.chronic_liver_disease |   1.935063   .1226422    10.42   0.000     1.709019    2.191005
            1.stroke_dementia |   2.142137   .0440715    37.03   0.000     2.057477    2.230281
                1.other_neuro |   2.701941   .0920359    29.18   0.000     2.527444    2.888486
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.301007   .0252753    13.54   0.000     1.252399    1.351501
           Stage 4/5 egfr<30  |   2.463531   .0818551    27.13   0.000      2.30821    2.629303
                              |
           1.organ_transplant |   3.056801   .3464712     9.86   0.000      2.44787     3.81721
                     1.spleen |   1.249001   .1755575     1.58   0.114     .9482425    1.645153
           1.ra_sle_psoriasis |   1.210558   .0350798     6.59   0.000     1.143719    1.281303
       1.other_imm_except_hiv |   3.546282   .6623374     6.78   0.000     2.459205    5.113894
                              |
      hiv#anycomorbidity_exht |
                         1 1  |   1.589793   .8679576     0.85   0.396     .5452829    4.635104
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0004
                                                Largest FMI       =     0.0004
DF adjustment:   Large sample                   DF:     min       =   5.16e+07
                                                        avg       =   5.16e+07
Within VCE type:          OIM                           max       =   5.16e+07

        _mi_1: _b[1.hiv]+_b[1.hiv#1.anycomorbidity_exht]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |     .90216   .2193375     4.11   0.000     .4722665    1.332054
------------------------------------------------------------------------------
. }

.         
. log close
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_bycomorbidities_exht.log
  log type:  text
 closed on:  30 Aug 2020, 02:56:32
----------------------------------------------------------------------------------------------------------------------------------
