----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_outcomes.log
  log type:  text
 opened on:  10 Jul 2020, 22:47:26

. 
. run global 

. 
. frames reset  

. use "cr_create_analysis_dataset.dta_STSET_onsdeath_fail1", clear
(Analysis dataset HIV project)

. 
. strate hiv, per(365000) output(./output/an_outcomes_RATES, replace)

         failure _d:  onsdeath == 1
   analysis time _t:  (stime_onsdeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Estimated failure rates
Number of records  =       17282435

  +--------------------------------------------------+
  | hiv       D         Y     Rate    Lower    Upper |
  |--------------------------------------------------|
  |   0   14857   6.7e+03   2.2186   2.1832   2.2546 |
  |   1      25   10.6754   2.3418   1.5824   3.4657 |
  +--------------------------------------------------+
   Notes: Rate = D/Y = failures/person-time (per 365000).
          Lower and Upper are bounds of 95% confidence intervals.


. 
. 
. ******************************
. *  Age-sex Cox model  *
. ******************************
. capture stcox age1 age2 age3 i.male i.hiv, strata(stp) 

. if _rc==0 {
.                 noi di _n  "AGE-SEX ADJUSTED (FULL STUDY POP)" _n 

AGE-SEX ADJUSTED (FULL STUDY POP)

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,435                  Number of obs    =  17,282,435
No. of failures =       14,882
Time at risk    =   2448136011
                                                LR chi2(5)       =    47229.10
Log likelihood  =   -176881.06                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        age1 |   1.171971   .0224916     8.27   0.000     1.128707    1.216893
        age2 |   .9018268   .0374519    -2.49   0.013     .8313304    .9783013
        age3 |   1.297252    .124351     2.71   0.007     1.075055    1.565374
      1.male |   1.676499   .0279073    31.04   0.000     1.622684    1.732098
       1.hiv |   2.898844   .5817359     5.30   0.000     1.956171    4.295787
------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_agesex, replace
(note: file ./output/models/an_outcomes_agesex.ster not found)
file ./output/models/an_outcomes_agesex.ster saved
.                 }

.         else {
.         di "WARNING - AGESEX MODEL DID NOT SUCCESSFULLY FIT"
.         }

.         
. **************************************
. *  Demographics +/- ethnicity model  *
. **************************************
. capture stcox age1 age2 age3 i.male i.imd i.ethnicity i.hiv, strata(stp) 

. if _rc==0 {
.                 noi di _n "DEMOGRAPHICS ADJUSTED INCLUDING ETHNICITY (COMPLETE CASES)" _n 

DEMOGRAPHICS ADJUSTED INCLUDING ETHNICITY (COMPLETE CASES)

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,724,742                  Number of obs    =  12,724,742
No. of failures =       11,091
Time at risk    =   1802666381
                                                LR chi2(13)      =    35960.04
Log likelihood  =   -128450.09                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------
                     _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                   age1 |   1.168376   .0258462     7.03   0.000     1.118801    1.220148
                   age2 |   .9119671   .0436272    -1.93   0.054     .8303456    1.001612
                   age3 |   1.265558   .1396713     2.13   0.033     1.019391    1.571172
                 1.male |    1.66672   .0321062    26.52   0.000     1.604967    1.730851
                        |
                    imd |
                     2  |   1.226097   .0399771     6.25   0.000     1.150195    1.307009
                     3  |   1.370178    .044638     9.67   0.000     1.285424    1.460521
                     4  |   1.735653   .0552593    17.32   0.000     1.630657     1.84741
       5 most deprived  |   2.068038   .0668315    22.48   0.000     1.941113    2.203262
                        |
              ethnicity |
                 Mixed  |    1.42352   .1640451     3.06   0.002     1.135722    1.784249
Asian or Asian British  |   1.361255   .0563029     7.46   0.000     1.255258    1.476203
                 Black  |   1.474797   .0908527     6.31   0.000     1.307059    1.664061
                 Other  |   1.200131   .1069845     2.05   0.041     1.007741     1.42925
                        |
                  1.hiv |   2.456816   .5524757     4.00   0.000     1.581099    3.817564
-----------------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_adjdemographics_inceth, replace
(note: file ./output/models/an_outcomes_adjdemographics_inceth.ster not found)
file ./output/models/an_outcomes_adjdemographics_inceth.ster saved
.                 }

.         else di "WARNING - hiv adj demog inc CC eth MODEL DID NOT SUCCESSFULLY FIT"

. 
. capture stcox age1 age2 age3 i.male i.imd i.hiv, strata(stp) 

. if _rc==0 {
.                 noi di _n  "DEMOGRAPHICS ADJUSTED EXCLUDING ETHNICITY (FULL STUDY POP)" _n 

DEMOGRAPHICS ADJUSTED EXCLUDING ETHNICITY (FULL STUDY POP)

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,435                  Number of obs    =  17,282,435
No. of failures =       14,882
Time at risk    =   2448136011
                                                LR chi2(9)       =    48106.85
Log likelihood  =   -176442.19                  Prob > chi2      =      0.0000

----------------------------------------------------------------------------------
              _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
            age1 |   1.169496   .0223516     8.19   0.000     1.126499    1.214136
            age2 |   .9132487   .0378154    -2.19   0.028     .8420597    .9904561
            age3 |   1.252458   .1197692     2.35   0.019     1.038401    1.510641
          1.male |    1.69093   .0281678    31.53   0.000     1.636614    1.747049
                 |
             imd |
              2  |   1.168976    .031862     5.73   0.000     1.108166    1.233123
              3  |   1.312631   .0358425     9.96   0.000     1.244228    1.384795
              4  |   1.684871   .0451126    19.48   0.000     1.598732    1.775651
5 most deprived  |    2.04371   .0557002    26.23   0.000     1.937404    2.155849
                 |
           1.hiv |   2.709395   .5437246     4.97   0.000     1.828319    4.015064
----------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_adjdemographics_noeth, replace
(note: file ./output/models/an_outcomes_adjdemographics_noeth.ster not found)
file ./output/models/an_outcomes_adjdemographics_noeth.ster saved
.                 }

.         else di "WARNING - hiv adj demog no eth MODEL DID NOT SUCCESSFULLY FIT"

. 
. 
. ******************************
. *  Multivariable Cox model  *
. ******************************
. 
. capture stcox   i.hiv i.ethnicity $adjustmentlist , strata(stp)

. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES)" _n 

FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES)

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,724,742                  Number of obs    =  12,724,742
No. of failures =       11,091
Time at risk    =   1802666381
                                                LR chi2(41)      =    40368.73
Log likelihood  =   -126245.75                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   2.212484   .4978852     3.53   0.000     1.423412    3.438982
                              |
                    ethnicity |
                       Mixed  |   1.402674   .1618213     2.93   0.003     1.118812    1.758558
      Asian or Asian British  |   1.317905   .0559612     6.50   0.000     1.212663    1.432281
                       Black  |   1.391721    .086499     5.32   0.000     1.232106    1.572015
                       Other  |   1.252722   .1119162     2.52   0.012     1.051501    1.492449
                              |
                         age1 |   1.187293   .0272843     7.47   0.000     1.135003    1.241992
                         age2 |   .8474426    .041993    -3.34   0.001     .7690082    .9338768
                         age3 |   1.503066   .1716033     3.57   0.000     1.201703    1.880004
                       1.male |   1.461396     .02925    18.96   0.000     1.405177    1.519865
                              |
                    obese4cat |
           Obese I (30-34.9)  |   .9983607   .0265816    -0.06   0.951     .9475979    1.051843
          Obese II (35-39.9)  |   1.346286   .0523727     7.64   0.000     1.247454     1.45295
             Obese III (40+)  |   1.808365   .0986329    10.86   0.000     1.625022    2.012393
                              |
                 smoke_nomiss |
                      Former  |   1.212512   .0265186     8.81   0.000     1.161635    1.265617
                     Current  |   .9875482   .0410398    -0.30   0.763     .9103002    1.071351
                              |
                          imd |
                           2  |   1.184176   .0386257     5.18   0.000      1.11084    1.262353
                           3  |   1.276847    .041691     7.48   0.000     1.197694    1.361231
                           4  |    1.55622   .0498159    13.82   0.000     1.461583    1.656986
             5 most deprived  |   1.749982   .0573279    17.08   0.000     1.641153    1.866028
                              |
               1.hypertension |   .9819846   .0217648    -0.82   0.412     .9402397    1.025583
1.chronic_respiratory_disease |   1.623472   .0399594    19.69   0.000     1.547012    1.703711
                              |
                    asthmacat |
                 Yes, no OCS  |   .9459411   .0289226    -1.82   0.069     .8909189    1.004361
                Yes with OCS  |    1.09065   .0599897     1.58   0.115     .9791888      1.2148
                              |
    1.chronic_cardiac_disease |   1.182266   .0252542     7.84   0.000      1.13379    1.232814
                              |
                      diabcat |
         Controlled diabetes  |   1.254814   .0311388     9.15   0.000     1.195244    1.317354
       Uncontrolled diabetes  |   1.832777   .0587892    18.89   0.000       1.7211    1.951701
  Diabetes, no hba1c measure  |   1.807061   .0892179    11.98   0.000     1.640391    1.990665
                              |
            cancer_exhaem_cat |
                   Last year  |   1.733108   .1177636     8.09   0.000     1.517005    1.979996
               2-5 years ago  |   1.227899   .0580637     4.34   0.000     1.119211    1.347142
                    5+ years  |   1.009054    .031452     0.29   0.772     .9492542    1.072621
                              |
              cancer_haem_cat |
                   Last year  |   2.723372   .4176505     6.53   0.000     2.016362    3.678285
               2-5 years ago  |   2.372966   .2228447     9.20   0.000     1.974038    2.852514
                    5+ years  |   1.622337   .1236379     6.35   0.000     1.397241    1.883697
                              |
      1.chronic_liver_disease |   1.914812   .1373859     9.05   0.000     1.663617    2.203936
            1.stroke_dementia |   2.180807   .0518073    32.82   0.000     2.081594    2.284748
                1.other_neuro |   2.631442   .1041587    24.44   0.000     2.435013    2.843717
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.311843   .0298029    11.95   0.000     1.254712    1.371576
           Stage 4/5 egfr<30  |   2.421106   .0937597    22.83   0.000     2.244141    2.612025
                              |
           1.organ_transplant |   3.134443   .4063419     8.81   0.000     2.431155     4.04118
                     1.spleen |   1.178279   .1944078     0.99   0.320     .8527187    1.628135
           1.ra_sle_psoriasis |   1.152446   .0390035     4.19   0.000     1.078481    1.231484
       1.other_imm_except_hiv |   3.389135   .7434778     5.56   0.000     2.204753    5.209761
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_adjfull_inceth, replace
(note: file ./output/models/an_outcomes_adjfull_inceth.ster not found)
file ./output/models/an_outcomes_adjfull_inceth.ster saved
.                 }

.         else di "WARNING - hiv adj demog inc CC eth MODEL DID NOT SUCCESSFULLY FIT"

. 
. capture stcox   i.hiv $adjustmentlist , strata(stp)

. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL NO ETHNICITY " _n 

FULLY ADJUSTED MODEL NO ETHNICITY 

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,282,435                  Number of obs    =  17,282,435
No. of failures =       14,882
Time at risk    =   2448136011
                                                LR chi2(37)      =    54066.10
Log likelihood  =   -173462.56                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   2.458575   .4936016     4.48   0.000     1.658785    3.643988
                         age1 |   1.192748   .0238567     8.81   0.000     1.146894    1.240435
                         age2 |   .8394867   .0362286    -4.05   0.000        .7714     .913583
                         age3 |   1.533666   .1525588     4.30   0.000     1.261998    1.863814
                       1.male |   1.493272   .0257936    23.21   0.000     1.443564    1.544692
                              |
                    obese4cat |
           Obese I (30-34.9)  |   .9902842   .0231139    -0.42   0.676     .9460024    1.036639
          Obese II (35-39.9)  |   1.332786   .0455507     8.41   0.000     1.246433    1.425121
             Obese III (40+)  |   1.817476   .0862051    12.60   0.000     1.656133    1.994538
                              |
                 smoke_nomiss |
                      Former  |   1.192899   .0221147     9.51   0.000     1.150333     1.23704
                     Current  |   .9571995   .0345809    -1.21   0.226     .8917661    1.027434
                              |
                          imd |
                           2  |   1.134412   .0309304     4.63   0.000     1.075381    1.196683
                           3  |   1.228902    .033623     7.53   0.000     1.164738    1.296601
                           4  |   1.517801   .0408601    15.50   0.000     1.439793    1.600036
             5 most deprived  |   1.747561   .0482658    20.21   0.000     1.655476    1.844767
                              |
               1.hypertension |   .9727427   .0183553    -1.46   0.143     .9374241    1.009392
1.chronic_respiratory_disease |    1.61058   .0346853    22.13   0.000     1.544013    1.680017
                              |
                    asthmacat |
                 Yes, no OCS  |   .9975048   .0263553    -0.09   0.925      .947164    1.050521
                Yes with OCS  |   1.117853   .0546289     2.28   0.023      1.01575    1.230219
                              |
    1.chronic_cardiac_disease |   1.198943    .022112     9.84   0.000     1.156378    1.243074
                              |
                      diabcat |
         Controlled diabetes  |   1.262018   .0272246    10.79   0.000     1.209771    1.316522
       Uncontrolled diabetes  |   1.897489   .0528453    23.00   0.000      1.79669    2.003943
  Diabetes, no hba1c measure  |   1.836327   .0790904    14.11   0.000     1.687676    1.998072
                              |
            cancer_exhaem_cat |
                   Last year  |   1.756474   .1023778     9.66   0.000     1.566854    1.969041
               2-5 years ago  |   1.192312   .0490953     4.27   0.000     1.099868    1.292527
                    5+ years  |   .9954778   .0267336    -0.17   0.866      .944436    1.049278
                              |
              cancer_haem_cat |
                   Last year  |   2.942386   .3759796     8.45   0.000     2.290512    3.779781
               2-5 years ago  |   2.281316   .1875609    10.03   0.000     1.941794    2.680205
                    5+ years  |   1.612391   .1065494     7.23   0.000     1.416517    1.835351
                              |
      1.chronic_liver_disease |   1.931737   .1225065    10.38   0.000     1.705951    2.187406
            1.stroke_dementia |   2.149105   .0443187    37.10   0.000     2.063974    2.237747
                1.other_neuro |   2.708562   .0922621    29.25   0.000     2.533636    2.895566
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.285569   .0250931    12.87   0.000     1.237316    1.335704
           Stage 4/5 egfr<30  |   2.426991   .0809817    26.57   0.000     2.273349    2.591017
                              |
           1.organ_transplant |   3.175633   .3601683    10.19   0.000     2.542672    3.966162
                     1.spleen |   1.260528    .177157     1.65   0.099     .9570245    1.660283
           1.ra_sle_psoriasis |    1.18869   .0344615     5.96   0.000      1.12303    1.258189
       1.other_imm_except_hiv |   3.533505   .6599984     6.76   0.000     2.450281    5.095604
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_adjfull_noeth, replace
(note: file ./output/models/an_outcomes_adjfull_noeth.ster not found)
file ./output/models/an_outcomes_adjfull_noeth.ster saved
.                 }

.         else di "WARNING - hiv full adj exc eth MODEL DID NOT SUCCESSFULLY FIT"

. 
. capture stcox   i.hiv  i.ethnicity i.hepc $adjustmentlist , strata(stp)

. if _rc==0 {
.                 noi di _n "FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES) PLUS HEP C" _n 

FULLY ADJUSTED MODEL INC ETHNICITY (COMPLETE CASES) PLUS HEP C

.                 estimates

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,724,742                  Number of obs    =  12,724,742
No. of failures =       11,091
Time at risk    =   1802666381
                                                LR chi2(42)      =    40369.73
Log likelihood  =   -126245.25                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   2.193602   .4940282     3.49   0.000     1.410769    3.410827
                              |
                    ethnicity |
                       Mixed  |   1.401323   .1616717     2.92   0.003     1.117723    1.756879
      Asian or Asian British  |   1.316855   .0559267     6.48   0.000     1.211679    1.431161
                       Black  |   1.391162   .0864634     5.31   0.000     1.231612    1.571381
                       Other  |   1.250759   .1117597     2.50   0.012     1.049822    1.490155
                              |
                       1.hepc |   1.219504   .2359059     1.03   0.305     .8346863    1.781735
                         age1 |   1.187018   .0272719     7.46   0.000     1.134752    1.241692
                         age2 |   .8479238   .0420098    -3.33   0.001     .7694575    .9343917
                         age3 |   1.501071   .1713499     3.56   0.000     1.200148    1.877445
                       1.male |   1.461286   .0292488    18.95   0.000      1.40507    1.519752
                              |
                    obese4cat |
           Obese I (30-34.9)  |   .9984229   .0265833    -0.06   0.953     .9476568    1.051909
          Obese II (35-39.9)  |   1.346455   .0523795     7.65   0.000     1.247609    1.453132
             Obese III (40+)  |   1.808664   .0986497    10.86   0.000      1.62529    2.012727
                              |
                 smoke_nomiss |
                      Former  |   1.212438   .0265172     8.81   0.000     1.161563    1.265541
                     Current  |   .9867626   .0410189    -0.32   0.749      .909555    1.070524
                              |
                          imd |
                           2  |   1.184056   .0386219     5.18   0.000     1.110727    1.262225
                           3  |   1.276762   .0416882     7.48   0.000     1.197615    1.361141
                           4  |   1.555996   .0498095    13.81   0.000      1.46137    1.656748
             5 most deprived  |   1.749502    .057315    17.07   0.000     1.640698    1.865522
                              |
               1.hypertension |   .9820144   .0217659    -0.82   0.413     .9402674    1.025615
1.chronic_respiratory_disease |   1.623491   .0399591    19.69   0.000     1.547032    1.703729
                              |
                    asthmacat |
                 Yes, no OCS  |   .9459024   .0289215    -1.82   0.069     .8908823     1.00432
                Yes with OCS  |   1.090399   .0599765     1.57   0.116     .9789617    1.214521
                              |
    1.chronic_cardiac_disease |   1.182237   .0252541     7.84   0.000     1.133762    1.232785
                              |
                      diabcat |
         Controlled diabetes  |   1.254942   .0311421     9.15   0.000     1.195365    1.317488
       Uncontrolled diabetes  |   1.832917   .0587938    18.89   0.000      1.72123     1.95185
  Diabetes, no hba1c measure  |   1.807046   .0892169    11.98   0.000     1.640378    1.990648
                              |
            cancer_exhaem_cat |
                   Last year  |   1.732554    .117728     8.09   0.000     1.516517    1.979368
               2-5 years ago  |    1.22746   .0580453     4.33   0.000     1.118806    1.346666
                    5+ years  |    1.00898   .0314497     0.29   0.774     .9491851    1.072542
                              |
              cancer_haem_cat |
                   Last year  |   2.723673    .417697     6.53   0.000     2.016585    3.678693
               2-5 years ago  |   2.373285   .2228743     9.20   0.000     1.974303    2.852896
                    5+ years  |   1.622105   .1236199     6.35   0.000     1.397042    1.883427
                              |
      1.chronic_liver_disease |   1.892472   .1378893     8.75   0.000     1.640624     2.18298
            1.stroke_dementia |   2.180702   .0518055    32.82   0.000     2.081493     2.28464
                1.other_neuro |   2.631479   .1041605    24.44   0.000     2.435046    2.843758
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.311853   .0298035    11.95   0.000     1.254721    1.371587
           Stage 4/5 egfr<30  |   2.421063   .0937569    22.83   0.000     2.244104    2.611977
                              |
           1.organ_transplant |   3.112378   .4043027     8.74   0.000     2.412792    4.014808
                     1.spleen |   1.178301   .1944109     0.99   0.320     .8527354    1.628164
           1.ra_sle_psoriasis |   1.152404   .0390021     4.19   0.000     1.078442    1.231439
       1.other_imm_except_hiv |   3.388325    .743296     5.56   0.000     2.204232    5.208503
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
.                 estimates save ./output/models/an_outcomes_adjfull_plushepc_inceth, replace
(note: file ./output/models/an_outcomes_adjfull_plushepc_inceth.ster not found)
file ./output/models/an_outcomes_adjfull_plushepc_inceth.ster saved
.                 }

.         else di "WARNING - hiv full adj plus hepc inc eth MODEL DID NOT SUCCESSFULLY FIT"

. 
.         
. log close
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_outcomes.log
  log type:  text
 closed on:  11 Jul 2020, 01:57:30
----------------------------------------------------------------------------------------------------------------------------------
