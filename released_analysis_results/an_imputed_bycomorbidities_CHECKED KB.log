----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_bycomorbidities.log
  log type:  text
 opened on:  29 Aug 2020, 19:21:13

. 
. ********************************   NOTES  **************************************
. 
. *  Assumes region is string, taking  values: 
. *    East, East Midlands, London, North East, North West, South East, 
. *    South West, West Midlands, and Yorkshire and The Humber
. *
. *  Assumes ethnicity is numeric, taking values: 
. *       1, 2, 3, 4, 5, (missing: . or .u)
. *       in the order White, Black, Asian, Mixed, Other
. *       with value labels exactly as above. 
. *       (NB: this is now intially recoded from ordering: 
. *      White, Mixed, Asian, Black, Other)       
. *
. *
. *  Assumes a complete case sample other than ethnicity
. *
. ********************************************************************************
. 
. run global

. 
. * Add imputations to the full dataset
. use "an_impute_imputeddata", clear
(Analysis dataset HIV project)

. 
. **************************
. *  Analyse imputed data  *
. **************************
. 
. // Declare imputed data as survival
. 
. mi stset stime_onsdeath, fail(onsdeath==1) enter(enter_date)    ///
>         origin(enter_date) id(patient_id)

                id:  patient_id
     failure event:  onsdeath == 1
obs. time interval:  (stime_onsdeath[_n-1], stime_onsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17282435  total observations
          0  exclusions
------------------------------------------------------------------------------
   17282435  observations remaining, representing
   17282435  subjects
     14,882  failures in single-failure-per-subject data
 2.4481e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       142

. 
. 
. if "`1'"=="demog"{
. mi estimate, eform: stcox i.hiv age1 age2 age3 i.male i.imd i.ethnicity, strata(stp)
. estimates save "./output/models/an_imputed_demog", replace                                              
. }

. 
. if "`1'"=="full"{
. mi estimate: stcox i.hiv i.ethnicity $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_full", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="fullplushepc"{
. mi estimate: stcox i.hiv i.ethnicity i.hepc $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_fullplushepc", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="byage"{
. gen ageover60 = agegroup>=4
. mi estimate (_b[1.hiv]+_b[1.hiv#1.ageover60]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd 1.hiv#1.ageover60, strata(stp
> )
. estimates save "./output/models/an_imputed_byage", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bysex"{
. mi estimate (_b[1.hiv]+_b[1.hiv#1.male]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.male, strata(stp)
. estimates save "./output/models/an_imputed_bysex", replace      
. mi estimate, eform                                      
. }

. 
. if "`1'"=="byethnicity"{
. mi passive: gen nonblack = (ethnicity != 4) if ethnicity<.
. mi estimate (_b[1.hiv]+_b[1.hiv#1.nonblack]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.nonblack, strata(stp)
. estimates save "./output/models/an_imputed_byethnicity", replace        
. mi estimate, eform                                      
. }

. 
. 
. if "`1'"=="bycomorbidities"{
. gen anycomorbidity =                                            ///
>         hypertension                                    ///
>         |chronic_respiratory_disease    ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd ///
>         i.hypertension                                  ///
>         i.chronic_respiratory_disease   ///
>         i.asthmacat                                             ///
>         i.chronic_cardiac_disease               ///
>         i.diabcat                                               ///
>         i.cancer_exhaem_cat                     ///
>         i.cancer_haem_cat                               ///
>         i.chronic_liver_disease                 ///
>         i.stroke_dementia                               ///
>         i.other_neuro                                   ///
>         i.reduced_kidney_function_cat   ///
>         i.organ_transplant                              ///
>         i.spleen                                                ///
>         i.ra_sle_psoriasis                      ///
>         i.other_imm_except_hiv                  ///
>         1.hiv#1.anycomorbidity, strata(stp)

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0286
                                                Largest FMI       =     0.4110
DF adjustment:   Large sample                   DF:     min       =      58.77
                                                        avg       =   1.77e+10
                                                        max       =   2.06e+11
Model F test:       Equal FMI                   F(  37,421546.9)  =    1019.40
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   .0101521   .7078315     0.01   0.989    -1.377172    1.397476
                              |
                    ethnicity |
                       Mixed  |   .3540416   .1306452     2.71   0.009     .0925997    .6154834
      Asian or Asian British  |   .2119434   .0402101     5.27   0.000     .1329217    .2909652
                       Black  |   .3457712   .0567831     6.09   0.000     .2344335    .4571089
                       Other  |   .1992367    .086587     2.30   0.022     .0290006    .3694728
                              |
                         age1 |   .1742958   .0198247     8.79   0.000       .13544    .2131516
                         age2 |  -.1604216   .0428255    -3.75   0.000    -.2443579   -.0764852
                         age3 |   .3832062    .098773     3.88   0.000     .1896147    .5767977
                       1.male |   .4088679    .016922    24.16   0.000     .3757013    .4420345
                              |
                          imd |
                           2  |   .1308483   .0272573     4.80   0.000      .077425    .1842717
                           3  |   .2083302    .027351     7.62   0.000     .1547232    .2619371
                           4  |   .4133764   .0269348    15.35   0.000     .3605851    .4661677
             5 most deprived  |   .5447447   .0276908    19.67   0.000     .4904717    .5990178
                              |
               1.hypertension |  -.0050098   .0187839    -0.27   0.790    -.0418254    .0318059
1.chronic_respiratory_disease |    .512482   .0211947    24.18   0.000     .4709412    .5540228
                              |
                    asthmacat |
                 Yes, no OCS  |   .0082558   .0264037     0.31   0.755    -.0434945    .0600062
                Yes with OCS  |   .1305733   .0488568     2.67   0.008     .0348158    .2263308
                              |
    1.chronic_cardiac_disease |   .1974388    .018443    10.71   0.000     .1612912    .2335864
                              |
                      diabcat |
         Controlled diabetes  |   .2437585   .0215948    11.29   0.000     .2014334    .2860836
       Uncontrolled diabetes  |   .6654595   .0277422    23.99   0.000     .6110858    .7198333
  Diabetes, no hba1c measure  |   .6050988   .0431314    14.03   0.000     .5205629    .6896347
                              |
            cancer_exhaem_cat |
                   Last year  |   .5744835   .0582903     9.86   0.000     .4602366    .6887304
               2-5 years ago  |   .1882308   .0411876     4.57   0.000     .1075047     .268957
                    5+ years  |   .0065976   .0268787     0.25   0.806    -.0460838     .059279
                              |
              cancer_haem_cat |
                   Last year  |   1.069722   .1277863     8.37   0.000     .8192656    1.320179
               2-5 years ago  |   .8279124    .082215    10.07   0.000      .666774    .9890508
                    5+ years  |   .4772164   .0660876     7.22   0.000     .3476871    .6067457
                              |
      1.chronic_liver_disease |   .6601418   .0633807    10.42   0.000     .5359179    .7843657
            1.stroke_dementia |   .7621713   .0206229    36.96   0.000     .7217511    .8025916
                1.other_neuro |   .9939291   .0340626    29.18   0.000     .9271676    1.060691
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   .2635927   .0195092    13.51   0.000     .2253554      .30183
           Stage 4/5 egfr<30  |   .9023154   .0333494    27.06   0.000     .8369519     .967679
                              |
           1.organ_transplant |   1.117928   .1133784     9.86   0.000     .8957101    1.340145
                     1.spleen |   .2222685   .1405584     1.58   0.114     -.053221     .497758
           1.ra_sle_psoriasis |   .1911759   .0289814     6.60   0.000     .1343734    .2479785
       1.other_imm_except_hiv |   1.265426   .1867696     6.78   0.000     .8993648    1.631488
                              |
           hiv#anycomorbidity |
                         1 1  |   .9147021   .7375424     1.24   0.215    -.5308545    2.360259
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0005
                                                Largest FMI       =     0.0005
DF adjustment:   Large sample                   DF:     min       =   4.00e+07
                                                        avg       =   4.00e+07
Within VCE type:          OIM                           max       =   4.00e+07

        _mi_1: _b[1.hiv]+_b[1.hiv#1.anycomorbidity]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |   .9248541   .2096964     4.41   0.000     .5138568    1.335852
------------------------------------------------------------------------------
. estimates save "./output/models/an_imputed_bycomorbidities", replace
file ./output/models/an_imputed_bycomorbidities.ster saved
. mi estimate, eform                                              

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0286
                                                Largest FMI       =     0.4110
DF adjustment:   Large sample                   DF:     min       =      58.77
                                                        avg       =   1.77e+10
                                                        max       =   2.06e+11
Model F test:       Equal FMI                   F(  37,421546.9)  =    1019.40
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |     exp(b)   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   1.010204    .715054     0.01   0.989      .252291    4.044979
                              |
                    ethnicity |
                       Mixed  |   1.424814   .1861451     2.71   0.009     1.097023    1.850551
      Asian or Asian British  |   1.236078   .0497028     5.27   0.000     1.142161    1.337718
                       Black  |   1.413079    .080239     6.09   0.000     1.264192    1.579501
                       Other  |   1.220471   .1056769     2.30   0.022     1.029425    1.446972
                              |
                         age1 |   1.190408   .0235995     8.79   0.000     1.145041    1.237572
                         age2 |   .8517846   .0364781    -3.75   0.000     .7832072    .9263667
                         age3 |   1.466981    .144898     3.88   0.000     1.208784    1.780328
                       1.male |   1.505113   .0254696    24.16   0.000     1.456012    1.555869
                              |
                          imd |
                           2  |   1.139795   .0310677     4.80   0.000     1.080501    1.202342
                           3  |    1.23162    .033686     7.62   0.000     1.167335    1.299445
                           4  |   1.511914   .0407232    15.35   0.000     1.434168    1.593874
             5 most deprived  |   1.724168   .0477437    19.67   0.000     1.633086     1.82033
                              |
               1.hypertension |   .9950028     .01869    -0.27   0.790     .9590372    1.032317
1.chronic_respiratory_disease |    1.66943    .035383    24.18   0.000     1.601501     1.74024
                              |
                    asthmacat |
                 Yes, no OCS  |    1.00829   .0266226     0.31   0.755     .9574378    1.061843
                Yes with OCS  |   1.139481   .0556714     2.67   0.008     1.035429     1.25399
                              |
    1.chronic_cardiac_disease |   1.218279   .0224687    10.71   0.000     1.175027    1.263122
                              |
                      diabcat |
         Controlled diabetes  |   1.276036   .0275558    11.29   0.000     1.223155    1.331204
       Uncontrolled diabetes  |   1.945384   .0539692    23.99   0.000     1.842431    2.054091
  Diabetes, no hba1c measure  |   1.831433   .0789922    14.03   0.000     1.682975    1.992987
                              |
            cancer_exhaem_cat |
                   Last year  |   1.776213    .103536     9.86   0.000     1.584449    1.991186
               2-5 years ago  |   1.207112    .049718     4.57   0.000     1.113496    1.308599
                    5+ years  |   1.006619   .0270567     0.25   0.806      .954962    1.061071
                              |
              cancer_haem_cat |
                   Last year  |    2.91457   .3724421     8.37   0.000     2.268833    3.744091
               2-5 years ago  |   2.288536    .188152    10.07   0.000     1.947943    2.688681
                    5+ years  |   1.611582   .1065056     7.22   0.000     1.415789    1.834452
                              |
      1.chronic_liver_disease |   1.935067   .1226458    10.42   0.000     1.709016    2.191017
            1.stroke_dementia |   2.142924   .0441934    36.96   0.000     2.058034    2.231316
                1.other_neuro |   2.701829   .0920315    29.18   0.000     2.527341    2.888365
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.301598   .0253931    13.51   0.000     1.252768    1.352331
           Stage 4/5 egfr<30  |   2.465305   .0822164    27.06   0.000     2.309317    2.631829
                              |
           1.organ_transplant |   3.058509   .3467688     9.86   0.000     2.449074    3.819598
                     1.spleen |   1.248907   .1755444     1.58   0.114     .9481704    1.645029
           1.ra_sle_psoriasis |   1.210672    .035087     6.60   0.000      1.14382    1.281432
       1.other_imm_except_hiv |   3.544604   .6620243     6.78   0.000     2.458041    5.111476
                              |
           hiv#anycomorbidity |
                         1 1  |   2.496032   1.840929     1.24   0.215     .5881022    10.59369
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0005
                                                Largest FMI       =     0.0005
DF adjustment:   Large sample                   DF:     min       =   4.00e+07
                                                        avg       =   4.00e+07
Within VCE type:          OIM                           max       =   4.00e+07

        _mi_1: _b[1.hiv]+_b[1.hiv#1.anycomorbidity]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |   .9248541   .2096964     4.41   0.000     .5138568    1.335852
------------------------------------------------------------------------------
. }

. 
. if "`1'"=="bycomorbidities_exht"{
. gen anycomorbidity_exht =                       ///                     
>         chronic_respiratory_disease     ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity_exht]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd ///
>         i.chronic_respiratory_disease   ///
>         i.asthmacat                                             ///
>         i.chronic_cardiac_disease               ///
>         i.diabcat                                               ///
>         i.cancer_exhaem_cat                     ///
>         i.cancer_haem_cat                               ///
>         i.chronic_liver_disease                 ///
>         i.stroke_dementia                               ///
>         i.other_neuro                                   ///
>         i.reduced_kidney_function_cat   ///
>         i.organ_transplant                              ///
>         i.spleen                                                ///
>         i.ra_sle_psoriasis                      ///
>         i.other_imm_except_hiv                  ///
>         1.hiv#1.anycomorbidity_exht, strata(stp)
. estimates save "./output/models/an_imputed_bycomorbidities_exht", replace
. mi estimate, eform                                              
. }

.         
. log close
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_bycomorbidities.log
  log type:  text
 closed on:  30 Aug 2020, 03:45:39
----------------------------------------------------------------------------------------------------------------------------------
