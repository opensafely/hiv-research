----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_byethnicity.log
  log type:  text
 opened on:  28 Aug 2020, 17:38:44

. 
. ********************************   NOTES  **************************************
. 
. *  Assumes region is string, taking  values: 
. *    East, East Midlands, London, North East, North West, South East, 
. *    South West, West Midlands, and Yorkshire and The Humber
. *
. *  Assumes ethnicity is numeric, taking values: 
. *       1, 2, 3, 4, 5, (missing: . or .u)
. *       in the order White, Black, Asian, Mixed, Other
. *       with value labels exactly as above. 
. *       (NB: this is now intially recoded from ordering: 
. *      White, Mixed, Asian, Black, Other)       
. *
. *
. *  Assumes a complete case sample other than ethnicity
. *
. ********************************************************************************
. 
. run global

. 
. * Add imputations to the full dataset
. use "an_impute_imputeddata", clear
(Analysis dataset HIV project)

. 
. **************************
. *  Analyse imputed data  *
. **************************
. 
. // Declare imputed data as survival
. 
. mi stset stime_onsdeath, fail(onsdeath==1) enter(enter_date)    ///
>         origin(enter_date) id(patient_id)

                id:  patient_id
     failure event:  onsdeath == 1
obs. time interval:  (stime_onsdeath[_n-1], stime_onsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17282435  total observations
          0  exclusions
------------------------------------------------------------------------------
   17282435  observations remaining, representing
   17282435  subjects
     14,882  failures in single-failure-per-subject data
 2.4481e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       142

. 
. 
. if "`1'"=="demog"{
. mi estimate, eform: stcox i.hiv age1 age2 age3 i.male i.imd i.ethnicity, strata(stp)
. estimates save "./output/models/an_imputed_demog", replace                                              
. }

. 
. if "`1'"=="full"{
. mi estimate: stcox i.hiv i.ethnicity $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_full", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="fullplushepc"{
. mi estimate: stcox i.hiv i.ethnicity i.hepc $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_fullplushepc", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="byage"{
. gen ageover60 = agegroup>=4
. mi estimate (_b[1.hiv]+_b[1.hiv#1.ageover60]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd 1.hiv#1.ageover60, strata(stp
> )
. estimates save "./output/models/an_imputed_byage", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bysex"{
. mi estimate (_b[1.hiv]+_b[1.hiv#1.male]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.male, strata(stp)
. estimates save "./output/models/an_imputed_bysex", replace      
. mi estimate, eform                                      
. }

. 
. if "`1'"=="byethnicity"{
. mi passive: gen nonblack = (ethnicity != 4) if ethnicity<.
m=0:
(4,557,693 missing values generated)
m=1:
m=2:
m=3:
m=4:
m=5:
m=6:
m=7:
m=8:
m=9:
m=10:
. mi estimate (_b[1.hiv]+_b[1.hiv#1.nonblack]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd  1.hiv#1.nonblack, strata(stp)

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0852
                                                Largest FMI       =     0.4288
DF adjustment:   Large sample                   DF:     min       =      54.06
                                                        avg       =   1.42e+10
                                                        max       =   1.49e+11
Model F test:       Equal FMI                   F(  14,19238.8)   =    2033.73
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------
                     _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                  1.hiv |     1.4502   .2931686     4.95   0.000      .875432    2.024969
                        |
              ethnicity |
                 Mixed  |   .3973643    .132366     3.00   0.004     .1319933    .6627353
Asian or Asian British  |   .3185057    .040134     7.94   0.000     .2395797    .3974316
                 Black  |    .416147   .0570097     7.30   0.000     .3043756    .5279183
                 Other  |   .1765428   .0858791     2.06   0.040     .0077724    .3453133
                        |
                   age1 |   .1547059   .0190766     8.11   0.000     .1173164    .1920954
                   age2 |  -.0817126   .0413462    -1.98   0.048    -.1627496   -.0006756
                   age3 |   .2009804   .0955046     2.10   0.035     .0137949     .388166
                 1.male |   .5232145   .0166565    31.41   0.000     .4905685    .5558606
                        |
                    imd |
                     2  |   .1561589   .0272553     5.73   0.000     .1027395    .2095784
                     3  |   .2643384   .0273214     9.68   0.000     .2107894    .3178873
                     4  |    .502654   .0268603    18.71   0.000     .4500087    .5552993
       5 most deprived  |   .6804861   .0274934    24.75   0.000        .6266    .7343723
                        |
           hiv#nonblack |
                   1 1  |  -.8765219   .4233202    -2.07   0.039    -1.707066   -.0459779
-----------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0481
                                                Largest FMI       =     0.0464
DF adjustment:   Large sample                   DF:     min       =   4,267.45
                                                        avg       =   4,267.45
Within VCE type:          OIM                           max       =   4,267.45

        _mi_1: _b[1.hiv]+_b[1.hiv#1.nonblack]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |   .5736786   .2928495     1.96   0.050    -.0004588    1.147816
------------------------------------------------------------------------------
. estimates save "./output/models/an_imputed_byethnicity", replace        
file ./output/models/an_imputed_byethnicity.ster saved
. mi estimate, eform                                      

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 17,282,435
                                                Average RVI       =     0.0852
                                                Largest FMI       =     0.4288
DF adjustment:   Large sample                   DF:     min       =      54.06
                                                        avg       =   1.42e+10
                                                        max       =   1.49e+11
Model F test:       Equal FMI                   F(  14,19238.8)   =    2033.73
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------
                     _t |     exp(b)   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                  1.hiv |   4.263969   1.250062     4.95   0.000     2.399912    7.575875
                        |
              ethnicity |
                 Mixed  |   1.487898   .1969471     3.00   0.004     1.141101    1.940092
Asian or Asian British  |   1.375071   .0551871     7.94   0.000     1.270715    1.487998
                 Black  |   1.516109    .086433     7.30   0.000     1.355778    1.695399
                 Other  |   1.193086   .1024612     2.06   0.040     1.007803    1.412432
                        |
                   age1 |   1.167315   .0222684     8.11   0.000     1.124475    1.211786
                   age2 |   .9215368    .038102    -1.98   0.048      .849804    .9993246
                   age3 |   1.222601    .116764     2.10   0.035      1.01389    1.474275
                 1.male |   1.687443   .0281068    31.41   0.000     1.633244    1.743441
                        |
                    imd |
                     2  |   1.169012   .0318618     5.73   0.000     1.108203    1.233158
                     3  |   1.302569    .035588     9.68   0.000     1.234652    1.374221
                     4  |   1.653103   .0444029    18.71   0.000     1.568326    1.742462
       5 most deprived  |   1.974838    .054295    24.75   0.000     1.871238    2.084173
                        |
           hiv#nonblack |
                   1 1  |   .4162281   .1761978    -2.07   0.039     .1813973     .955063
-----------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0481
                                                Largest FMI       =     0.0464
DF adjustment:   Large sample                   DF:     min       =   4,267.45
                                                        avg       =   4,267.45
Within VCE type:          OIM                           max       =   4,267.45

        _mi_1: _b[1.hiv]+_b[1.hiv#1.nonblack]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |   .5736786   .2928495     1.96   0.050    -.0004588    1.147816
------------------------------------------------------------------------------
. }

. 
. 
. if "`1'"=="bycomorbidities"{
. gen anycomorbidity =                                            ///
>         hypertension                                    ///
>         |chronic_respiratory_disease    ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd 1.hiv#1.anycomorbidity, 
> strata(stp)
. estimates save "./output/models/an_imputed_bycomorbidities", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bycomorbidities_exht"{
. gen anycomorbidity_exht =                       ///                     
>         chronic_respiratory_disease     ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity_exht]): stcox i.hiv i.ethnicity age1 age2 age3 i.male i.imd 1.hiv#1.anycomorbid
> ity_exht, strata(stp)
. estimates save "./output/models/an_imputed_bycomorbidities_exht", replace
. mi estimate, eform                                              
. }

.         
. log close
      name:  <unnamed>
       log:  e:\analyses\hiv-research\analysis\output/an_imputed_byethnicity.log
  log type:  text
 closed on:  28 Aug 2020, 22:08:29
----------------------------------------------------------------------------------------------------------------------------------
