----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_imputed_take2_byethnicity.log
  log type:  text
 opened on:  12 Jul 2020, 22:34:24

. 
. ********************************   NOTES  **************************************
. 
. *  Assumes region is string, taking  values: 
. *    East, East Midlands, London, North East, North West, South East, 
. *    South West, West Midlands, and Yorkshire and The Humber
. *
. *  Assumes ethnicity is numeric, taking values: 
. *       1, 2, 3, 4, 5, (missing: . or .u)
. *       in the order White, Black, Asian, Mixed, Other
. *       with value labels exactly as above. 
. *       (NB: this is now intially recoded from ordering: 
. *      White, Mixed, Asian, Black, Other)       
. *
. *
. *  Assumes a complete case sample other than ethnicity
. *
. ********************************************************************************
. 
. run global

. 
. * Add imputations to the full dataset
. use "an_impute_take2", clear
(Analysis dataset HIV project)

. 
. **************************
. *  Analyse imputed data  *
. **************************
. 
. // Declare imputed data as survival
. 
. mi stset stime_onsdeath, fail(onsdeath==1) enter(enter_date)    ///
>         origin(enter_date) id(patient_id)

                id:  patient_id
     failure event:  onsdeath == 1
obs. time interval:  (stime_onsdeath[_n-1], stime_onsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17282435  total observations
          0  exclusions
------------------------------------------------------------------------------
   17282435  observations remaining, representing
   17282435  subjects
     14,882  failures in single-failure-per-subject data
 2.4481e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       142

. 
. 
. if "`1'"=="demog"{
. mi estimate, eform: stcox i.hiv age1 age2 age3 i.male i.imd i.ethnicity, strata(stp)
. estimates save "./output/models/an_imputed_take2_demog", replace                                                
. }

. 
. if "`1'"=="full"{
. mi estimate: stcox i.hiv i.ethnicity $adjustmentlist, strata(stp)
. estimates save "./output/models/an_imputed_take2_full", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="byage"{
. gen ageover60 = agegroup>=4
. mi estimate (_b[1.hiv]+_b[1.hiv#1.ageover60]): stcox i.hiv i.ethnicity $adjustmentlist 1.hiv#1.ageover60, strata(stp)
. estimates save "./output/models/an_imputed_take2_byage", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="bysex"{
. mi estimate (_b[1.hiv]+_b[1.hiv#1.male]): stcox i.hiv i.ethnicity $adjustmentlist 1.hiv#1.male, strata(stp)
. estimates save "./output/models/an_imputed_take2_bysex", replace        
. mi estimate, eform                                      
. }

. 
. if "`1'"=="byethnicity"{
. gen nonblack = (ethnicity != 4) if ethnicity<.
(4,557,693 missing values generated)
. mi estimate (_b[1.hiv]+_b[1.hiv#1.nonblack]): stcox i.hiv i.ethnicity $adjustmentlist 1.hiv#1.nonblack, strata(stp)

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 12,724,742
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =   9.74e+58
                                                        avg       =   2.78e+61
                                                        max       =          .
Model F test:       Equal FMI                   F(  42, 3.4e+59)  =     713.44
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   1.391578    .307924     4.52   0.000     .7880576    1.995098
                              |
                    ethnicity |
                       Mixed  |   .3419134   .1153664     2.96   0.003     .1157993    .5680275
      Asian or Asian British  |   .2756228   .0424641     6.49   0.000     .1923946     .358851
                       Black  |    .312552   .0630802     4.95   0.000     .1889171    .4361868
                       Other  |   .2252199   .0893396     2.52   0.012     .0501174    .4003223
                              |
                         age1 |   .1713472   .0229713     7.46   0.000     .1263243    .2163702
                         age2 |  -.1646736   .0495372    -3.32   0.001    -.2617647   -.0675825
                         age3 |   .4054238   .1141372     3.55   0.000      .181719    .6291286
                       1.male |   .3799168   .0200146    18.98   0.000     .3406889    .4191446
                              |
                    obese4cat |
           Obese I (30-34.9)  |  -.0021847   .0266264    -0.08   0.935    -.0543715    .0500021
          Obese II (35-39.9)  |   .2971572   .0389016     7.64   0.000     .2209115     .373403
             Obese III (40+)  |   .5920947   .0545428    10.86   0.000     .4851928    .6989965
                              |
                 smoke_nomiss |
                      Former  |   .1928462   .0218714     8.82   0.000     .1499791    .2357132
                     Current  |  -.0116298    .041558    -0.28   0.780     -.093082    .0698224
                              |
                          imd |
                           2  |   .1691267   .0326181     5.19   0.000     .1051964     .233057
                           3  |   .2443664   .0326513     7.48   0.000      .180371    .3083619
                           4  |   .4423969   .0320104    13.82   0.000     .3796576    .5051362
             5 most deprived  |   .5595682   .0327602    17.08   0.000     .4953594     .623777
                              |
               1.hypertension |  -.0182438   .0221634    -0.82   0.410    -.0616833    .0251957
1.chronic_respiratory_disease |   .4842543   .0246144    19.67   0.000     .4360109    .5324977
                              |
                    asthmacat |
                 Yes, no OCS  |  -.0553702   .0305761    -1.81   0.070    -.1152981    .0045578
                Yes with OCS  |   .0871956   .0550041     1.59   0.113    -.0206105    .1950017
                              |
    1.chronic_cardiac_disease |   .1673328   .0213613     7.83   0.000     .1254654    .2092001
                              |
                      diabcat |
         Controlled diabetes  |   .2270265    .024815     9.15   0.000       .17839     .275663
       Uncontrolled diabetes  |   .6061648    .032076    18.90   0.000      .543297    .6690326
  Diabetes, no hba1c measure  |    .591135   .0493767    11.97   0.000     .4943585    .6879116
                              |
            cancer_exhaem_cat |
                   Last year  |   .5499555   .0679495     8.09   0.000     .4167769    .6831341
               2-5 years ago  |   .2055028    .047287     4.35   0.000     .1128219    .2981836
                    5+ years  |   .0093511     .03117     0.30   0.764    -.0517409    .0704432
                              |
              cancer_haem_cat |
                   Last year  |   1.002345   .1533607     6.54   0.000      .701764    1.302927
               2-5 years ago  |   .8640594   .0939102     9.20   0.000     .6799988     1.04812
                    5+ years  |   .4822704    .076222     6.33   0.000     .3328781    .6316628
                              |
      1.chronic_liver_disease |    .650347   .0717462     9.06   0.000     .5097271    .7909669
            1.stroke_dementia |   .7796625   .0237566    32.82   0.000     .7331005    .8262244
                1.other_neuro |   .9670945   .0395848    24.43   0.000     .8895097    1.044679
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   .2715892   .0227181    11.95   0.000     .2270625     .316116
           Stage 4/5 egfr<30  |    .883661   .0387295    22.82   0.000     .8077527    .9595694
                              |
           1.organ_transplant |   1.141014   .1296457     8.80   0.000     .8869134    1.395115
                     1.spleen |    .165245   .1649936     1.00   0.317    -.1581365    .4886265
           1.ra_sle_psoriasis |   .1421169   .0338442     4.20   0.000     .0757835    .2084504
       1.other_imm_except_hiv |   1.223092   .2193704     5.58   0.000     .7931343    1.653051
                              |
                 hiv#nonblack |
                         1 1  |  -1.028895   .4538772    -2.27   0.023    -1.918477   -.1393117
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
Within VCE type:          OIM                           max       =          .

        _mi_1: _b[1.hiv]+_b[1.hiv#1.nonblack]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |    .362683   .3339732     1.09   0.277    -.2918923    1.017258
------------------------------------------------------------------------------
. estimates save "./output/models/an_imputed_take2_byethnicity", replace  
(note: file ./output/models/an_imputed_take2_byethnicity.ster not found)
file ./output/models/an_imputed_take2_byethnicity.ster saved
. mi estimate, eform                                      

Multiple-imputation estimates                   Imputations       =         10
Stratified Cox regr.: Breslow method for ties   Number of obs     = 12,724,742
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =   9.74e+58
                                                        avg       =   2.78e+61
                                                        max       =          .
Model F test:       Equal FMI                   F(  42, 3.4e+59)  =     713.44
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------------
                           _t |     exp(b)   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                        1.hiv |   4.021189   1.238221     4.52   0.000     2.199121    7.352921
                              |
                    ethnicity |
                       Mixed  |   1.407638   .1623942     2.96   0.003     1.122771    1.764783
      Asian or Asian British  |   1.317351   .0559402     6.49   0.000     1.212149    1.431683
                       Black  |   1.366909   .0862248     4.95   0.000     1.207941    1.546798
                       Other  |   1.252598   .1119066     2.52   0.012     1.051395    1.492306
                              |
                         age1 |   1.186903   .0272647     7.46   0.000      1.13465    1.241562
                         age2 |   .8481705    .042016    -3.32   0.001     .7696921    .9346506
                         age3 |   1.499938   .1711987     3.55   0.000     1.199277    1.875975
                       1.male |   1.462163   .0292646    18.98   0.000     1.405916     1.52066
                              |
                    obese4cat |
           Obese I (30-34.9)  |   .9978177   .0265683    -0.08   0.935     .9470802    1.051273
          Obese II (35-39.9)  |   1.346027   .0523626     7.64   0.000     1.247213     1.45267
             Obese III (40+)  |   1.807771   .0986009    10.86   0.000     1.624488    2.011733
                              |
                 smoke_nomiss |
                      Former  |   1.212696   .0265233     8.82   0.000      1.16181    1.265811
                     Current  |   .9884376   .0410775    -0.28   0.780     .9111188    1.072318
                              |
                          imd |
                           2  |    1.18427   .0386286     5.19   0.000     1.110929    1.262453
                           3  |   1.276812   .0416896     7.48   0.000     1.197662    1.361193
                           4  |   1.556433   .0498221    13.82   0.000     1.461784    1.657211
             5 most deprived  |   1.749917   .0573276    17.08   0.000     1.641088    1.865963
                              |
               1.hypertension |   .9819216   .0217627    -0.82   0.410     .9401806    1.025516
1.chronic_respiratory_disease |   1.622964   .0399483    19.67   0.000     1.546526    1.703181
                              |
                    asthmacat |
                 Yes, no OCS  |   .9461349   .0289291    -1.81   0.070     .8911004    1.004568
                Yes with OCS  |    1.09111   .0600156     1.59   0.113     .9796005    1.215313
                              |
    1.chronic_cardiac_disease |   1.182148   .0252522     7.83   0.000     1.133676    1.232692
                              |
                      diabcat |
         Controlled diabetes  |   1.254863   .0311394     9.15   0.000     1.195291    1.317404
       Uncontrolled diabetes  |   1.833386   .0588077    18.90   0.000     1.721674    1.952348
  Diabetes, no hba1c measure  |   1.806037   .0891762    11.97   0.000     1.639446    1.989556
                              |
            cancer_exhaem_cat |
                   Last year  |   1.733176   .1177685     8.09   0.000     1.517064    1.980074
               2-5 years ago  |   1.228142   .0580752     4.35   0.000     1.119433    1.347409
                    5+ years  |   1.009395   .0314628     0.30   0.764     .9495748    1.072984
                              |
              cancer_haem_cat |
                   Last year  |   2.724665   .4178565     6.54   0.000     2.017308    3.680052
               2-5 years ago  |   2.372773   .2228277     9.20   0.000     1.973875    2.852284
                    5+ years  |   1.619748   .1234604     6.33   0.000     1.394977    1.880735
                              |
      1.chronic_liver_disease |   1.916206   .1374804     9.06   0.000     1.664837    2.205528
            1.stroke_dementia |   2.180736   .0518068    32.82   0.000     2.081524    2.284677
                1.other_neuro |   2.630291   .1041196    24.43   0.000     2.433936    2.842487
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.312048   .0298073    11.95   0.000     1.254908    1.371789
           Stage 4/5 egfr<30  |   2.419742   .0937153    22.82   0.000     2.242862    2.610572
                              |
           1.organ_transplant |   3.129941   .4057835     8.80   0.000     2.427625     4.03544
                     1.spleen |   1.179682     .19464     1.00   0.317     .8537332    1.630076
           1.ra_sle_psoriasis |   1.152711   .0390126     4.20   0.000     1.078729    1.231768
       1.other_imm_except_hiv |   3.397679   .7453503     5.58   0.000     2.210313    5.222889
                              |
                 hiv#nonblack |
                         1 1  |   .3574018   .1622165    -2.27   0.023     .1468303    .8699568
-----------------------------------------------------------------------------------------------

Transformations                                 Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
Within VCE type:          OIM                           max       =          .

        _mi_1: _b[1.hiv]+_b[1.hiv#1.nonblack]

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _mi_1 |    .362683   .3339732     1.09   0.277    -.2918923    1.017258
------------------------------------------------------------------------------
. }

. 
. if "`1'"=="bycomorbidities"{
. gen anycomorbidity =                                            ///
>         hypertension                                    ///
>         |chronic_respiratory_disease    ///
>         |(asthmacat>1)                                  ///
>         |chronic_cardiac_disease                ///
>         |(diabcat>1)                                    ///
>         |(cancer_exhaem_cat>1)                  ///
>         |(cancer_haem_cat>1)                    ///
>         |chronic_liver_disease                  ///
>         |stroke_dementia                                ///
>         |other_neuro                                    ///
>         |(reduced_kidney_function_cat>1)        ///
>         |organ_transplant                               ///
>         |spleen                                                 ///
>         |ra_sle_psoriasis                               ///
>         |other_imm_except_hiv           
. mi estimate (_b[1.hiv]+_b[1.hiv#1.anycomorbidity]): stcox i.hiv i.ethnicity $adjustmentlist 1.hiv#1.anycomorbidity, strata(stp)
. estimates save "./output/models/an_imputed_take2_bycomorbidities", replace
. mi estimate, eform                                              
. }

. 
. if "`1'"=="cuminc"{
. xi $adjustmentlist
. for num 2/5: mi passive: gen _Iethnicity_X=(ethnicity==X) 
. mi estimate, cmdok: stpm2 hiv age1 age2 age3 _I*, df(3) scale(hazard) eform 
. estimates save "./output/models/an_imputed_take2_cuminc", replace
. mi estimate, eform      
. }

.         
. log close
      name:  <unnamed>
       log:  E:\analyses\hiv-research\analysis\output/an_imputed_take2_byethnicity.log
  log type:  text
 closed on:  13 Jul 2020, 05:43:52
----------------------------------------------------------------------------------------------------------------------------------
